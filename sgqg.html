<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>上古情歌中控道具ID</title>
  <style>
    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background-color: #f5f7fa;
      padding: 20px;
      line-height: 1.5;
    }
    .main-container {
      display: flex;
      gap: 20px;
      max-width: 1400px;
      margin: 0 auto;
      flex-wrap: wrap;
    }
    .container {
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      flex: 1;
      transition: all 0.25s ease;
    }
    .container:hover {
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
    }
    .panel {
      background: #fff;
      width: 250px;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      position: relative;
      transition: all 0.25s ease;
    }
    .panel:hover {
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
    }
    h2, h3 {
      text-align: center;
      color: #343a40;
      margin-bottom: 20px;
      font-weight: 600;
    }
    h2 {
      font-size: 1.8rem;
      margin: 0 0 25px;
      position: relative;
      padding-bottom: 12px;
    }
    h2:after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 4px;
      background: linear-gradient(90deg, #4361ee, #7209b7);
      border-radius: 2px;
    }
    h3 {
      margin-bottom: 15px;
      border-bottom: 1px solid #e9ecef;
      padding-bottom: 8px;
      text-align: left;
      font-size: 1.2rem;
      color: #495057;
    }
    label {
      display: block;
      margin: 18px 0 8px;
      font-weight: 500;
      color: #495057;
      font-size: 14px;
    }
    input, select, button {
      width: 100%;
      padding: 10px 12px;
      margin: 6px 0 12px;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      font-size: 15px;
      box-sizing: border-box;
    }
    input, select {
      background-color: #f8f9fa;
      transition: all 0.25s ease;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #4361ee;
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
      background-color: #fff;
    }
    input::placeholder {
      color: #adb5bd;
      font-size: 14px;
    }
    button {
      color: white;
      border: none;
      cursor: pointer;
      transition: all 0.25s ease;
      font-weight: 500;
      margin: 10px 0;
      position: relative;
      overflow: hidden;
    }
    button:before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: 0.5s;
    }
    button:hover:before {
      left: 100%;
    }
    button:not(.save-result-btn):not(.clear-selected-btn):not(.export-btn):not(.import-btn):not(.copy-saved-btn):not(.delete-saved-btn):not(.add-player-btn):not(.save-common-btn):not(.save-uncommon-btn):not(.daily-recharge-btn) {
      background-color: #4361ee;
    }
    button:not(.save-result-btn):not(.clear-selected-btn):not(.export-btn):not(.import-btn):not(.copy-saved-btn):not(.delete-saved-btn):not(.add-player-btn):not(.save-common-btn):not(.save-uncommon-btn):not(.daily-recharge-btn):hover {
      background-color: #3a56d4;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(67, 97, 238, 0.2);
    }
    .button-group {
      display: flex;
      gap: 10px;
      margin: 15px 0;
    }
    #result {
      margin: 20px 0;
      padding: 15px;
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      font-family: monospace;
      white-space: pre-wrap;
      color: #343a40;
      min-height: 120px;
      outline: none;
      font-size: 14px;
      line-height: 1.6;
      transition: all 0.25s ease;
    }
    #result:focus {
      outline: none;
      border-color: #4361ee;
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
      background-color: #fff;
    }
    #itemList, #combineList {
      display: none;
      width: 100%;
      max-height: 330px;
      overflow-y: auto;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      margin: 5px 0;
      padding: 5px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .search-container {
      position: relative;
    }
    .toast {
      position: fixed;
      bottom: 25px;
      left: 50%;
      transform: translate(-50%, 20px);
      background-color: #343a40;
      color: white;
      padding: 12px 20px;
      border-radius: 30px;
      z-index: 100;
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .show-toast {
      opacity: 1;
      transform: translate(-50%, 0);
    }
    .item-option {
      padding: 8px 12px;
      cursor: pointer;
      border-radius: 6px;
      margin: 2px 0;
      transition: all 0.25s ease;
    }
    .item-option:hover {
      background-color: rgba(67, 97, 238, 0.05);
      padding-left: 15px;
    }
    .item-option.selected {
      background-color: rgba(67, 97, 238, 0.1);
      color: #4361ee;
      font-weight: 500;
    }
    .selected-item {
      padding: 8px 12px;
      margin: 4px 0;
      background-color: rgba(67, 97, 238, 0.05);
      border-radius: 4px;
      display: flex;
      flex-direction: column;
      border-left: 3px solid #4361ee;
      transition: all 0.25s ease;
    }
    .selected-item:hover {
      background-color: rgba(67, 97, 238, 0.1);
      transform: translateX(3px);
    }
    .selected-item-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      cursor: pointer;
      color: #495057;
      font-weight: 500;
    }
    .selected-item-qty {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .selected-item-qty input {
      width: 144px;
      padding: 5px;
      margin: 0;
    }
    .selected-items-container, .saved-results-container, .player-ids-container {
      max-height: 650px;
      overflow-y: auto;
      margin-bottom: 15px;
      flex: 1;
    }
    .clear-selected-btn {
      position: absolute;
      top: 32px;
      right: 25px;
      width: auto;
      padding: 5px 10px;
      background-color: #eb4f5b;
    }
    .clear-selected-btn:hover {
      background-color: #d62828;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(230, 57, 70, 0.2);
    }
    .save-result-btn, .save-common-btn {
      background-color: #4361ee;
    }
    .save-result-btn:hover, .save-common-btn:hover {
      background-color: #3a56d4;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(67, 97, 238, 0.2);
    }
    .saved-result {
      padding: 10px;
      margin: 8px 0;
      background-color: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #e9ecef;
      transition: all 0.25s ease;
      position: relative;
      overflow: hidden;
    }
    .saved-result:before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background-color: #4361ee;
      opacity: 0;
      transition: all 0.25s ease;
    }
    .saved-result:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      border-color: #dee2e6;
    }
    .saved-result:hover:before {
      opacity: 1;
    }
    .saved-result-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .saved-result-content {
      font-family: monospace;
      white-space: pre-wrap;
      font-size: 12px;
      color: #6c757d;
      line-height: 1.5;
    }
    .saved-result-actions {
      display: flex;
      gap: 5px;
      margin-top: 5px;
    }
    .saved-result-actions button {
      padding: 5px 10px;
      font-size: 12px;
      margin: 0;
    }
    .copy-saved-btn {
      background-color: #4361ee;
    }
    .copy-saved-btn:hover {
      background-color: #3a56d4;
    }
    .delete-saved-btn {
      background-color: #eb4f5b;
    }
    .delete-saved-btn:hover {
      background-color: #d62828;
    }
    .panel-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(5px);
    }
    .modal.show .modal-content {
      transform: scale(1);
      opacity: 1;
    }
    .modal-content {
      background: white;
      padding: 25px;
      border-radius: 12px;
      width: 400px;
      max-width: 90%;
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
      transform: scale(0.95);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .modal-title {
      font-size: 1.3rem;
      margin-bottom: 20px;
      color: #4361ee;
      font-weight: 600;
      border-bottom: 1px solid #e9ecef;
      padding-bottom: 10px;
    }
    .modal-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    .modal-buttons button {
      flex: 1;
    }
    .saved-result-name {
      cursor: pointer;
      flex: 1;
      padding: 2px 5px;
      border-radius: 4px;
      color: #4361ee;
      transition: all 0.25s ease;
    }
    .saved-result-name:hover {
      background-color: rgba(67, 97, 238, 0.05);
      color: #3a56d4;
    }
    .import-export-buttons {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    .import-export-buttons button {
      flex: 1;
      padding: 8px;
      font-size: 14px;
    }
    .export-btn, .save-uncommon-btn {
      background-color: #7209b7;
    }
    .export-btn:hover, .save-uncommon-btn:hover {
      background-color: #5e0bad;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(114, 9, 183, 0.2);
    }
    .import-btn {
      background-color: #ffb703;
      color: #343a40;
    }
    .import-btn:hover {
      background-color: #fb8500;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(255, 183, 3, 0.2);
    }
    .hidden {
      display: none;
    }
    .player-id-item {
      padding: 8px 12px;
      margin: 4px 0;
      background-color: rgba(251, 133, 0, 0.05);
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      min-height: 40px;
      border-left: 3px solid #ffb703;
      transition: all 0.25s ease;
    }
    .player-id-item:hover {
      background-color: rgba(251, 133, 0, 0.1);
      transform: translateX(3px);
    }
    .player-id-item .delete-btn {
      color: white;
      background-color: #e63946;
      font-weight: bold;
      padding: 4px 8px;
      border-radius: 4px;
      border: none;
      width: auto;
      font-size: 12px;
    }
    .player-id-item .delete-btn:hover {
      background-color: #d32f2f;
      transform: none;
    }
    .player-id-info {
      color: #495057;
      font-size: 14px;
    }
    #addPlayerModal .modal-content {
      width: 350px;
    }
    #addPlayerModal label {
      margin: 10px 0 5px;
    }
    /* 单日累充方案样式 */
    .daily-recharge-container {
      width: 100%;
      margin-top: 20px;
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transition: all 0.25s ease;
    }
    .daily-recharge-container:hover {
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
    }
    .daily-recharge-header {
      margin-bottom: 15px;
    }
    .daily-recharge-header h3 {
      text-align: center;
      margin-bottom: 10px;
      border-bottom: 1px solid #e9ecef;
      padding-bottom: 8px;
      color: #495057;
      font-size: 1.2rem;
    }
    .daily-recharge-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .daily-recharge-btn {
      flex: 1;
      min-width: 120px;
      background-color: #219ebc;
    }
    .daily-recharge-btn:hover {
      background-color: #1d3557;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(33, 158, 188, 0.2);
    }
    /* 累充方案选择弹窗样式 */
    #rechargeSchemeList {
      max-height: 300px;
      overflow-y: auto;
      margin: 15px 0;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 5px;
    }
    .recharge-scheme-option {
      padding: 10px 12px;
      margin: 5px 0;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      border-left: 3px solid transparent;
    }
    .recharge-scheme-option:hover {
      background-color: rgba(67, 97, 238, 0.05);
      border-left-color: #4361ee;
    }
    .recharge-scheme-name {
      font-weight: 500;
      color: #4361ee;
      margin-bottom: 5px;
    }
    .recharge-scheme-desc {
      font-size: 13px;
      color: #6c757d;
    }
    /* 非常用方案样式 */
    .uncommon-schemes-container {
      width: 100%;
      margin-top: 20px;
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transition: all 0.25s ease;
    }
    .uncommon-schemes-container:hover {
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
    }
    .uncommon-schemes-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .uncommon-schemes-content {
      max-height: 1000000px;
      overflow-y: auto;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    #uncommonSavedResultsContainer .saved-result {
      width: 250px;
      box-sizing: border-box;
    }
    .save-type-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .save-type-buttons button {
      flex: 1;
    }
    .add-player-btn {
      background-color: #ffb703;
      color: #343a40;
    }
    .add-player-btn:hover {
      background-color: #fb8500;
      transform: translateY(-2px);
    }
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f8f9fa;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb {
      background: #ced4da;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #adb5bd;
    }
    @media (max-width: 1200px) {
      .main-container {
        justify-content: center;
      }
      .panel {
        width: 100%;
        max-width: 350px;
      }
      #uncommonSavedResultsContainer .saved-result {
        width: 250px;
      }
    }
    @media (max-width: 768px) {
      #uncommonSavedResultsContainer .saved-result {
        width: 250px;
      }
      .button-group {
        flex-direction: column;
        gap: 8px;
      }
      body {
        padding: 10px;
      }
      .container, .panel, .uncommon-schemes-container, .daily-recharge-container {
        padding: 15px;
      }
      .daily-recharge-buttons {
        flex-direction: column;
      }
    }
    @media (max-width: 480px) {
      #uncommonSavedResultsContainer .saved-result {
        width: 100%;
      }
      h2 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="main-container">
    <!-- 左侧已选择面板 -->
    <div class="panel">
      <div class="panel-title">
        <h3>已选择道具</h3>
        <button class="clear-selected-btn" onclick="clearAllSelections()">清空所有选择</button>
      </div>
      <div class="selected-items-container" id="selectedItemsContainer">
        <!-- 已选择道具将在这里显示 -->
      </div>
    </div>

    <!-- 主操作区域 -->
    <div class="container">
      <h2>上古情歌</h2>

      <div class="search-container">
        <label for="itemInput">道具名称</label>
        <input type="text" id="itemInput" placeholder="输入道具名称或ID..." oninput="filterItems('item')">
        <div id="itemList"></div>
      </div>

      <div class="search-container">
        <label for="combineInput">套装&自定义组合</label>
        <input type="text" id="combineInput" placeholder="搜索组合名称..." oninput="filterItems('combine')">
        <div id="combineList"></div>
      </div>

      <div class="button-group">
        <button onclick="addSelectedItems()">添加已选择道具</button>
        <button class="save-result-btn" onclick="openSaveDialog()">保存方案</button>
      </div>

      <div class="button-group">
        <button onclick="clearResult()">清空当前方案</button>
        <button onclick="copyResult()">复制当前方案</button>
      </div>

      <label>已选道具ID（可编辑）</label>
      <div id="result" contenteditable="true" spellcheck="false"></div>
    </div>

    <!-- 右侧常用方案面板 -->
    <div class="panel">
      <div class="panel-title">
        <h3>常用方案</h3>
        <span id="savedCount">0个</span>
      </div>
      
      <div class="import-export-buttons">
        <button class="export-btn" onclick="exportSavedResults()">导出方案</button>
        <button class="import-btn" onclick="importSavedResults()">导入方案</button>
      </div>
      
      <div class="saved-results-container" id="savedResultsContainer">
        <!-- 保存的结果将在这里显示 -->
      </div>
    </div>
    
    <!-- 新增：角色ID面板 -->
    <div class="panel">
      <div class="panel-title">
        <h3>常用角色ID</h3>
        <span id="playerCount">0个</span>
      </div>
      
      <button class="add-player-btn" onclick="openAddPlayerDialog()">新增角色</button>
      
      <div class="player-ids-container" id="playerIdsContainer">
        <!-- 角色ID列表将在这里显示 -->
      </div>
    </div>
  </div>

  <!-- 新增：单日累充方案区域 -->
  <div class="main-container">
    <div class="daily-recharge-container">
      <div class="daily-recharge-header">
        <h3>单日累充方案（无称号，称号需自选）</h3>
      </div>
      <div class="button-group daily-recharge-buttons">
        <button class="daily-recharge-btn" onclick="openRechargeModal(500)">单日500</button>
        <button class="daily-recharge-btn" onclick="openRechargeModal(1000)">单日1000</button>
        <button class="daily-recharge-btn" onclick="openRechargeModal(2000)">单日2000</button>
        <button class="daily-recharge-btn" onclick="openRechargeModal(3000)">单日3000</button>
        <button class="daily-recharge-btn" onclick="openRechargeModal(5000)">单日5000</button>
        <button class="daily-recharge-btn" onclick="openRechargeModal(10000)">单日10000</button>
      </div>
    </div>
  </div>

  <!-- 新增：非常用方案区域 -->
  <div class="main-container">
    <div class="uncommon-schemes-container">
      <div class="uncommon-schemes-header">
        <h3>非常用方案</h3>
        <span id="uncommonSavedCount">0个</span>
      </div>
      
      <div class="uncommon-schemes-content" id="uncommonSavedResultsContainer">
        <!-- 非常用方案将在这里显示 -->
      </div>
    </div>
  </div>

  <!-- 保存方案模态框 -->
  <div id="saveModal" class="modal">
    <div class="modal-content">
      <div class="modal-title">保存方案</div>
      <label for="schemeName">方案名称</label>
      <input type="text" id="schemeName" placeholder="输入方案名称..." value="未命名方案">
      <div class="save-type-buttons">
        <button class="save-common-btn" onclick="saveResult('common')">保存为常用方案</button>
        <button class="save-uncommon-btn" onclick="saveResult('uncommon')">保存为非常用方案</button>
      </div>
      <div class="modal-buttons">
        <button onclick="closeModal('saveModal')">取消</button>
      </div>
    </div>
  </div>
  
  <!-- 编辑方案名称模态框 -->
  <div id="editNameModal" class="modal">
    <div class="modal-content">
      <div class="modal-title">修改方案名称</div>
      <label for="editSchemeName">方案名称</label>
      <input type="text" id="editSchemeName" placeholder="输入方案名称...">
      <div class="modal-buttons">
        <button onclick="closeModal('editNameModal')">取消</button>
        <button class="save-result-btn" onclick="updateSchemeName()">更新</button>
      </div>
    </div>
  </div>
  
  <!-- 新增角色模态框 -->
  <div id="addPlayerModal" class="modal">
    <div class="modal-content">
      <div class="modal-title">添加常用角色</div>
      <label for="playerServer">区服</label>
      <input type="number" id="playerServer" placeholder="输入区服数字...">
      
      <label for="playerName">角色名</label>
      <input type="text" id="playerName" placeholder="输入角色名...">
      
      <label for="playerId">角色ID</label>
      <input type="number" id="playerId" placeholder="输入角色ID...">
      
      <div class="modal-buttons">
        <button onclick="closeModal('addPlayerModal')">取消</button>
        <button class="save-result-btn" onclick="addPlayer()">添加</button>
      </div>
    </div>
  </div>

  <!-- 单日累充方案选择模态框 -->
  <div id="rechargeModal" class="modal">
    <div class="modal-content">
      <div class="modal-title" id="rechargeModalTitle">选择单日累充方案</div>
      <div id="rechargeSchemeList">
        <!-- 累充方案选项将动态生成 -->
      </div>
      <div class="modal-buttons">
        <button onclick="closeModal('rechargeModal')">取消</button>
      </div>
    </div>
  </div>
  
  <!-- 导入文件输入（隐藏） -->
  <input type="file" id="importFile" class="hidden" accept=".json" onchange="handleFileImport(event)">

  <div id="toast" class="toast">已复制到剪贴板</div>

  <script>
    // 道具数据
    const items = [
      { name: '10000铜钱', id: 22005 },
      { name: '5000称号20号', id: 32640 },
      { name: '狂飙头盔', id: 37100 },
      { name: '狂飙铠甲', id: 37788 },
      { name: '狂飙战靴', id: 37641 },
      { name: '狂飙武器', id: 37285 },
      { name: '狂飙饰品', id: 37472 },
      { name: '至尊冠名凭证', id: 38537 },
      { name: '高级强化石', id: 39154 },
      { name: '稀有材料箱', id: 48500 },
      { name: '海量经验丹', id: 28445 },
      { name: '500累充专属武器', id: 50001 },
      { name: '500累充专属铠甲', id: 50002 },
      { name: '1000累充坐骑碎片', id: 51001 },
      { name: '1000累充翅膀碎片', id: 51002 },
      { name: '2000累充神器礼盒', id: 52001 },
      { name: '2000累充宝石礼盒', id: 52002 },
      { name: '3000累充神兽蛋', id: 53001 },
      { name: '3000累充技能书', id: 53002 },
      { name: '5000累充红装礼盒', id: 55001 },
      { name: '5000累充神宠碎片', id: 55002 },
      { name: '10000累充至尊套装', id: 56001 },
      { name: '10000累充特殊称号', id: 56002 }
    ];

    // 预设组合
    const combines = {
      狂飙套装Set: { 
        name: '狂飙套装', 
        items: [
          {id: 37100, qty: 1},
          {id: 37788, qty: 1},
          {id: 37641, qty: 1},
          {id: 37285, qty: 1},
          {id: 37472, qty: 1}
        ] 
      },
      至尊冠名礼包Set: {
        name: '至尊冠名礼包',
        items: [
          { id: 38537, qty: 1 },
          { id: 39154, qty: 50 },
          { id: 48500, qty: 99 },
          { id: 28445, qty: 999 }
        ]
      }
    };

    // 单日累充方案数据（每个累充档位对应多个可选方案）
    const dailyRechargeSchemes = {
      500: [
        {
          name: '荒古至尊',
          desc: '',
          items: [
            {id: 39476, qty: 25},
            {id: 27801, qty: 1},
            {id: 46386, qty: 1}
          ]
        },
        {
          name: '渴血战神',
          desc: '',
          items: [
            {id: 39476, qty: 25},
            {id: 27802, qty: 1},
            {id: 46385, qty: 1}
          ]
        },
        {
          name: '圣翼鹰王',
          desc: '',
          items: [
            {id: 39476, qty: 25},
            {id: 27804, qty: 1},
            {id: 46388, qty: 1}
          ]
        },
        {
          name: '六翼神使',
          desc: '',
          items: [
            {id: 39476, qty: 25},
            {id: 46396, qty: 1},
            {id: 46387, qty: 1}
          ]
        },
        {
          name: '金翎圣使',
          desc: '',
          items: [
            {id: 39476, qty: 25},
            {id: 46397, qty: 1},
            {id: 46389, qty: 1}
          ]
        },
        {
          name: '夺魂灵君',
          desc: '',
          items: [
            {id: 39476, qty: 25},
            {id: 46401, qty: 1},
            {id: 46405, qty: 1}
          ]
        }
      ],
      1000: [
        {
          name: '极地套装',
          desc: '',
          items: [
            {id: 39476, qty: 50},
            {id: 37233, qty: 1},
            {id: 37053, qty: 1},
            {id: 37706, qty: 1},
            {id: 37615, qty: 1},
            {id: 37433, qty: 1}
          ]
        },
        {
          name: '远古套装',
          desc: '',
          items: [
            {id: 39476, qty: 50},
      {id: 37054, qty: 1},
      {id: 37722, qty: 1},
      {id: 37622, qty: 1},
      {id: 37213, qty: 1},
      {id: 37411, qty: 1}
          ]
        },
        {
          name: '洪荒套装',
          desc: '',
          items: [
            {id: 39476, qty: 50},
      {id: 37065, qty: 1},
      {id: 37751, qty: 1},
      {id: 37649, qty: 1},
      {id: 37246, qty: 1},
      {id: 37524, qty: 1}
          ]
        },
        {
          name: '狂飙套装',
          desc: '',
          items: [
            {id: 39476, qty: 50},
      {id: 37100, qty: 1},
      {id: 37788, qty: 1},
      {id: 37641, qty: 1},
      {id: 37285, qty: 1},
      {id: 37472, qty: 1}
          ]
        },
        {
          name: '接福套装',
          desc: '',
          items: [
            {id: 39476, qty: 50},
      {id: 37097, qty: 1},
      {id: 37785, qty: 1},
      {id: 37657, qty: 1},
      {id: 37282, qty: 1},
      {id: 37470, qty: 1},
      {id: 38771, qty: 1}
          ]
        },
        {
          name: '太极离殇',
          desc: '',
          items: [
            {id: 39476, qty: 50},
      {id: 37071, qty: 1},
      {id: 38752, qty: 1},
      {id: 38137, qty: 1},
      {id: 37253, qty: 1},
      {id: 37756, qty: 1},
      {id: 37318, qty: 1},
      {id: 37446, qty: 1}
          ]
        }
      ],
      2000: [
        {
          name: '星界套装',
          desc: '',
          items: [
            {id: 39476, qty: 100},
      {id: 37048, qty: 1},
      {id: 37653, qty: 1},
      {id: 37755, qty: 1},
      {id: 37239, qty: 1},
      {id: 37525, qty: 1}
          ]
        },
        {
          name: '冰晶套装',
          desc: '',
          items: [
            {id: 39476, qty: 100},
      {id: 37072, qty: 1},
      {id: 37254, qty: 1},
      {id: 37654, qty: 1},
      {id: 37757, qty: 1},
      {id: 37443, qty: 1}
          ]
        },
        {
          name: '暗炎套装',
          desc: '',
          items: [
            {id: 39476, qty: 100},
      {id: 37073, qty: 1},
      {id: 37758, qty: 1},
      {id: 37655, qty: 1},
      {id: 37255, qty: 1},
      {id: 37445, qty: 1}
          ]
        },
        {
          name: '寒风刺骨阵',
          desc: '',
          items: [
            {id: 39476, qty: 100},
      {id: 28116, qty: 1},
      {id: 28117, qty: 1},
      {id: 28118, qty: 1},
      {id: 28119, qty: 1},
      {id: 28120, qty: 1}
          ]
        },
        {
          name: '福满乾坤阵',
          desc: '',
          items: [
            {id: 39476, qty: 100},
      {id: 28126, qty: 1},
      {id: 28127, qty: 1},
      {id: 28128, qty: 1},
      {id: 28129, qty: 1},
      {id: 28130, qty: 1}
          ]
        }
      ],
      3000: [
        {
          name: '鸿蒙套装',
          desc: '',
          items: [
            {id: 39476, qty: 150},
      {id: 37055, qty: 1},
      {id: 37724, qty: 1},
      {id: 37624, qty: 1},
      {id: 37212, qty: 1},
      {id: 37419, qty: 1}
          ]
        },
        {
          name: '弑天套装',
          desc: '',
          items: [
            {id: 39476, qty: 150},
      {id: 37058, qty: 1},
      {id: 37750, qty: 1},
      {id: 37648, qty: 1},
      {id: 37238, qty: 1},
      {id: 37434, qty: 1}
          ]
        },
        {
          name: '怪物饕餮',
          desc: '',
          items: [
            {id: 39476, qty: 150},
      {id: 37088, qty: 1},
      {id: 37777, qty: 1},
      {id: 37656, qty: 1},
      {id: 37274, qty: 1},
      {id: 37466, qty: 1},
      {id: 38138, qty: 1}
          ]
        },
        {
          name: '夜色如水阵',
          desc: '',
          items: [
            {id: 39476, qty: 150},
      {id: 28111, qty: 1},
      {id: 28112, qty: 1},
      {id: 28113, qty: 1},
      {id: 28114, qty: 1},
      {id: 28115, qty: 1}
          ]
        },
        {
          name: '枯荣星空阵',
          desc: '',
          items: [
            {id: 39476, qty: 150},
      {id: 28101, qty: 1},
      {id: 28102, qty: 1},
      {id: 28103, qty: 1},
      {id: 28104, qty: 1},
      {id: 28105, qty: 1}
          ]
        },
        {
          name: '阿修罗',
          desc: '',
          items: [
            {id: 39476, qty: 150},
      {id: 57310, qty: 1},
      {id: 57311, qty: 1},
      {id: 57312, qty: 1},
      {id: 57313, qty: 1},
      {id: 57314, qty: 1}
          ]
        },
        {
          name: '丹青无极',
          desc: '',
          items: [
            {id: 39476, qty: 150},
      {id: 57315, qty: 1},
      {id: 57316, qty: 1},
      {id: 57317, qty: 1},
      {id: 57318, qty: 1},
      {id: 57319, qty: 1}
          ]
        }
      ],
      5000: [

      ],
      10000: [

      ]
    };

    let selectedItems = [];
    let selectedCombines = [];
    let savedResults = { common: [], uncommon: [] };
    let playerIds = [];
    let currentEditId = null;
    let currentEditType = null;
    let currentRechargeAmount = 0; // 当前选中的累充金额

    // 显示Toast通知
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show-toast');
      setTimeout(() => {
        toast.classList.remove('show-toast');
      }, 2000);
    }

    // 更新已选择面板
    function updateSelectedPanel() {
      const container = document.getElementById('selectedItemsContainer');
      container.innerHTML = '';

      // 添加道具
      selectedItems.forEach(item => {
        const itemData = items.find(i => i.id == item.id);
        if (itemData) {
          const div = document.createElement('div');
          div.className = 'selected-item';
          
          const header = document.createElement('div');
          header.className = 'selected-item-header';
          header.textContent = `${itemData.name} (ID: ${itemData.id})`;
          header.onclick = () => removeSelection('item', item.id);
          
          const qtyDiv = document.createElement('div');
          qtyDiv.className = 'selected-item-qty';
          qtyDiv.innerHTML = `
            <span>数量:</span>
            <input type="number" value="${item.qty || 1}" min="1" onchange="updateItemQty('${item.id}', this.value)">
          `;
          
          div.appendChild(header);
          div.appendChild(qtyDiv);
          container.appendChild(div);
        }
      });

      // 添加组合
      selectedCombines.forEach(combine => {
        const combo = combines[combine.key];
        if (combo) {
          const div = document.createElement('div');
          div.className = 'selected-item';
          
          const header = document.createElement('div');
          header.className = 'selected-item-header';
          header.textContent = combo.name;
          header.onclick = () => removeSelection('combine', combine.key);
          
          div.appendChild(header);
          container.appendChild(div);
        }
      });
    }

    // 更新道具数量
    function updateItemQty(itemId, qty) {
      const item = selectedItems.find(i => i.id == itemId);
      if (item) {
        item.qty = parseInt(qty) || 1;
      }
    }

    // 移除单个选择
    function removeSelection(type, id) {
      if (type === 'item') {
        selectedItems = selectedItems.filter(item => item.id !== id);
        // 取消对应的选项选中状态
        document.querySelectorAll('#itemList .item-option').forEach(option => {
          if (option.dataset.id == id) {
            option.classList.remove('selected');
          }
        });
      } else {
        selectedCombines = selectedCombines.filter(c => c.key !== id);
        // 取消对应的选项选中状态
        document.querySelectorAll('#combineList .item-option').forEach(option => {
          if (option.dataset.key == id) {
            option.classList.remove('selected');
          }
        });
      }
      updateSelectedPanel();
    }

    // 清空所有选择
    function clearAllSelections() {
      selectedItems = [];
      selectedCombines = [];
      // 取消所有选项的选中状态
      document.querySelectorAll('.item-option.selected').forEach(el => {
        el.classList.remove('selected');
      });
      updateSelectedPanel();
      showToast('已清空所有选择');
    }

    // 清空结果
    function clearResult() {
      document.getElementById('result').textContent = '';
      // 清空输入框
      document.getElementById('itemInput').value = '';
      document.getElementById('combineInput').value = '';
      // 隐藏下拉列表
      document.getElementById('itemList').style.display = 'none';
      document.getElementById('combineList').style.display = 'none';
      showToast('已清空结果');
    }

    // 过滤项目（道具或组合）
    function filterItems(type) {
      const input = document.getElementById(`${type}Input`).value.toLowerCase();
      const list = document.getElementById(`${type}List`);
      list.innerHTML = '';

      if (!input) {
        list.style.display = 'none';
        return;
      }

      let filtered = [];
      if (type === 'item') {
        filtered = items.filter(item => 
          item.name.toLowerCase().includes(input) || 
          String(item.id).includes(input)
        );
      } else {
        filtered = Object.entries(combines)
          .filter(([key, combo]) => 
            combo.name.toLowerCase().includes(input)
          )
          .map(([key, combo]) => ({
            key,
            name: combo.name,
            items: combo.items
          }));
      }

      if (filtered.length > 0) {
        filtered.forEach(item => {
          const option = document.createElement('div');
          option.className = 'item-option';
          if (type === 'item') {
            option.textContent = `${item.name} (ID: ${item.id})`;
            option.dataset.id = item.id;
            option.dataset.name = item.name;
            option.onclick = function() {
              this.classList.toggle('selected');
              const itemId = this.dataset.id;
              if (this.classList.contains('selected')) {
                if (!selectedItems.some(i => i.id == itemId)) {
                  selectedItems.push({ id: itemId, qty: 1 });
                }
              } else {
                selectedItems = selectedItems.filter(item => item.id !== itemId);
              }
              updateSelectedPanel();
            };
          } else {
            option.textContent = item.name;
            option.dataset.key = item.key;
            option.onclick = function() {
              this.classList.toggle('selected');
              const combineKey = this.dataset.key;
              if (this.classList.contains('selected')) {
                if (!selectedCombines.some(c => c.key === combineKey)) {
                  selectedCombines.push({ key: combineKey });
                }
              } else {
                selectedCombines = selectedCombines.filter(c => c.key !== combineKey);
              }
              updateSelectedPanel();
            };
          }
          list.appendChild(option);
        });
        list.style.display = 'block';
      } else {
        list.style.display = 'none';
      }
    }

    // 添加选中的道具
    function addSelectedItems() {
      // 添加选中的道具
      selectedItems.forEach(item => {
        const itemData = items.find(i => i.id == item.id);
        if (itemData) {
          appendResult(`${itemData.id}#${item.qty || 1}#1`);
        }
      });
      
      // 添加选中的组合
      selectedCombines.forEach(combine => {
        const combo = combines[combine.key];
        if (combo && combo.items) {
          combo.items.forEach(item => {
            appendResult(`${item.id}#${item.qty || 1}#1`);
          });
        }
      });
      
      showToast(`已添加 ${selectedItems.length + selectedCombines.length} 个道具/组合`);
    }

    // 打开保存对话框
    function openSaveDialog() {
      const result = document.getElementById('result').textContent.trim();
      if (!result) {
        showToast('没有可保存的内容');
        return;
      }
      
      document.getElementById('schemeName').value = '未命名方案';
      const modal = document.getElementById('saveModal');
      modal.style.display = 'flex';
      setTimeout(() => modal.classList.add('show'), 10);
    }

    // 关闭模态框
    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (!modal) return;
      modal.classList.remove('show');
      setTimeout(() => modal.style.display = 'none', 300);
    }

    // 保存当前结果
    function saveResult(type) {
      const result = document.getElementById('result').textContent.trim();
      const name = document.getElementById('schemeName').value || '未命名方案';
      
      if (!result) {
        showToast('没有可保存的内容');
        return;
      }

      const timestamp = new Date().toLocaleString();
      savedResults[type].push({
        id: Date.now(),
        name: name,
        time: timestamp,
        content: result
      });

      // 保存到localStorage
      localStorage.setItem('sgqg_saved_results', JSON.stringify(savedResults));
      
      updateSavedResultsPanel();
      closeModal('saveModal');
      showToast(`方案已保存为${type === 'common' ? '常用' : '非常用'}方案`);
    }

    // 更新保存结果面板
    function updateSavedResultsPanel() {
      // 更新常用方案
      const commonContainer = document.getElementById('savedResultsContainer');
      commonContainer.innerHTML = '';
      document.getElementById('savedCount').textContent = `${savedResults.common.length}个`;
      
      renderSavedResults(commonContainer, savedResults.common, 'common');
      
      // 更新非常用方案
      const uncommonContainer = document.getElementById('uncommonSavedResultsContainer');
      uncommonContainer.innerHTML = '';
      document.getElementById('uncommonSavedCount').textContent = `${savedResults.uncommon.length}个`;
      
      renderSavedResults(uncommonContainer, savedResults.uncommon, 'uncommon');
    }
    
    // 渲染保存的结果
    function renderSavedResults(container, results, type) {
      // 按添加时间倒序排序
      const sortedResults = [...results].sort((a, b) => new Date(b.time) - new Date(a.time));
      
      sortedResults.forEach((result, index) => {
        const resultDiv = document.createElement('div');
        resultDiv.className = 'saved-result';
        
        const header = document.createElement('div');
        header.className = 'saved-result-header';
        
        // 可点击的名称
        const nameSpan = document.createElement('span');
        nameSpan.className = 'saved-result-name';
        nameSpan.textContent = result.name;
        nameSpan.onclick = () => {
          currentEditId = result.id;
          currentEditType = type;
          document.getElementById('editSchemeName').value = result.name;
          const modal = document.getElementById('editNameModal');
          modal.style.display = 'flex';
          setTimeout(() => modal.classList.add('show'), 10);
        };
        
        const timeSpan = document.createElement('span');
        timeSpan.textContent = result.time;
        timeSpan.style.fontSize = '12px';
        timeSpan.style.color = '#666';
        
        header.appendChild(nameSpan);
        header.appendChild(timeSpan);
        
        // 显示内容转换为中文名格式
        const displayContent = result.content.split('\n').map(line => {
          const parts = line.split('#');
          if (parts.length >= 1) {
            const itemId = parts[0];
            const item = items.find(i => i.id == itemId);
            if (item) {
              return `${item.name}#${parts[1] || '1'}#${parts[2] || '1'}`;
            }
          }
          return line;
        }).join('\n');
        
        const content = document.createElement('div');
        content.className = 'saved-result-content';
        content.textContent = displayContent;
        
        const actions = document.createElement('div');
        actions.className = 'saved-result-actions';
        
        const copyBtn = document.createElement('button');
        copyBtn.className = 'copy-saved-btn';
        copyBtn.textContent = '复制ID';
        copyBtn.onclick = () => {
          // 复制原始ID格式内容
          navigator.clipboard.writeText(result.content)
            .then(() => showToast('已复制ID到剪贴板'))
            .catch(err => showToast('复制失败'));
        };
        
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-saved-btn';
        deleteBtn.textContent = '删除';
        deleteBtn.onclick = () => {
          savedResults[type] = savedResults[type].filter(r => r.id !== result.id);
          // 更新localStorage
          localStorage.setItem('sgqg_saved_results', JSON.stringify(savedResults));
          updateSavedResultsPanel();
          showToast('已删除保存结果');
        };
        
        actions.appendChild(copyBtn);
        actions.appendChild(deleteBtn);
        
        resultDiv.appendChild(header);
        resultDiv.appendChild(content);
        resultDiv.appendChild(actions);
        
        container.appendChild(resultDiv);
      });
    }

    // 更新方案名称
    function updateSchemeName() {
      if (!currentEditId || !currentEditType) return;
      
      const newName = document.getElementById('editSchemeName').value || '未命名方案';
      const result = savedResults[currentEditType].find(r => r.id === currentEditId);
      
      if (result) {
        result.name = newName;
        // 更新localStorage
        localStorage.setItem('sgqg_saved_results', JSON.stringify(savedResults));
        updateSavedResultsPanel();
        showToast('方案名称已更新');
      }
      
      closeModal('editNameModal');
      currentEditId = null;
      currentEditType = null;
    }

    // 导出保存的方案
    function exportSavedResults() {
      if (savedResults.common.length === 0 && savedResults.uncommon.length === 0) {
        showToast('没有可导出的方案');
        return;
      }
      
      const dataToExport = {
        common: savedResults.common,
        uncommon: savedResults.uncommon
      };
      
      const dataStr = JSON.stringify(dataToExport, null, 2);
      const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
      
      const exportFileDefaultName = '上古情歌方案备份.json';
      
      const linkElement = document.createElement('a');
      linkElement.setAttribute('href', dataUri);
      linkElement.setAttribute('download', exportFileDefaultName);
      linkElement.click();
      
      showToast('方案已导出');
    }

    // 导入保存的方案
    function importSavedResults() {
      document.getElementById('importFile').click();
    }

    // 处理文件导入
    function handleFileImport(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const imported = JSON.parse(e.target.result);
          
          // 检查导入的数据格式
          if (!imported.common || !imported.uncommon) {
            throw new Error('无效的导入文件格式');
          }
          
          // 合并常用方案
          imported.common.forEach(item => {
            if (!savedResults.common.some(r => r.id === item.id)) {
              savedResults.common.push(item);
            }
          });
          
          // 合并非常用方案
          imported.uncommon.forEach(item => {
            if (!savedResults.uncommon.some(r => r.id === item.id)) {
              savedResults.uncommon.push(item);
            }
          });
          
          // 更新localStorage
          localStorage.setItem('sgqg_saved_results', JSON.stringify(savedResults));
          updateSavedResultsPanel();
          showToast(`成功导入 ${imported.common.length} 个常用方案和 ${imported.uncommon.length} 个非常用方案`);
          
        } catch (error) {
          console.error('导入失败:', error);
          showToast('导入失败: ' + error.message);
        }
        
        // 重置文件输入
        event.target.value = '';
      };
      
      reader.readAsText(file);
    }

    // 追加结果
    function appendResult(text) {
      const result = document.getElementById('result');
      if (result.textContent.trim()) {
        result.textContent += '\n' + text;
      } else {
        result.textContent = text;
      }
    }

    // 复制结果
    function copyResult() {
      const result = document.getElementById('result');
      if (!result.textContent.trim()) {
        showToast('结果为空');
        return;
      }
      
      navigator.clipboard.writeText(result.textContent)
        .then(() => showToast('已复制到剪贴板'))
        .catch(err => showToast('复制失败'));
    }

    // 打开添加角色对话框
    function openAddPlayerDialog() {
      document.getElementById('playerServer').value = '';
      document.getElementById('playerName').value = '';
      document.getElementById('playerId').value = '';
      const modal = document.getElementById('addPlayerModal');
      modal.style.display = 'flex';
      setTimeout(() => modal.classList.add('show'), 10);
    }

    // 添加角色
    function addPlayer() {
      const server = document.getElementById('playerServer').value.trim();
      const name = document.getElementById('playerName').value.trim();
      const id = document.getElementById('playerId').value.trim();
      
      if (!server || !name || !id) {
        showToast('请填写完整的角色信息');
        return;
      }
      
      if (!/^\d+$/.test(server)) {
        showToast('区服必须为纯数字');
        return;
      }
      
      if (!/^\d+$/.test(id)) {
        showToast('角色ID必须为纯数字');
        return;
      }
      
      // 检查是否已存在相同ID的角色
      if (playerIds.some(p => p.id === id)) {
        showToast('该角色ID已存在');
        return;
      }
      
      playerIds.push({
        server: server,
        name: name,
        id: id,
        time: new Date().toLocaleString()
      });
      
      // 保存到localStorage
      localStorage.setItem('sgqg_player_ids', JSON.stringify(playerIds));
      
      updatePlayerIdsPanel();
      closeModal('addPlayerModal');
      showToast('角色已添加');
    }

    // 更新角色ID面板
    function updatePlayerIdsPanel() {
      const container = document.getElementById('playerIdsContainer');
      container.innerHTML = '';
      document.getElementById('playerCount').textContent = `${playerIds.length}个`;
      
      // 按添加时间倒序排序
      const sortedPlayers = [...playerIds].sort((a, b) => new Date(b.time) - new Date(a.time));
      
      sortedPlayers.forEach(player => {
        const div = document.createElement('div');
        div.className = 'player-id-item';
        
        const infoDiv = document.createElement('div');
        infoDiv.className = 'player-id-info';
        infoDiv.textContent = `${player.server}-${player.name}-${player.id}`;
        
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = '删除';
        deleteBtn.onclick = (e) => {
          e.stopPropagation();
          deletePlayer(player.id);
        };
        
        div.appendChild(infoDiv);
        div.appendChild(deleteBtn);
        
        div.onclick = () => {
          navigator.clipboard.writeText(player.id)
            .then(() => showToast(`已复制角色ID: ${player.id}`))
            .catch(err => showToast('复制失败'));
        };
        
        container.appendChild(div);
      });
    }

    // 删除角色
    function deletePlayer(playerId) {
      playerIds = playerIds.filter(p => p.id !== playerId);
      localStorage.setItem('sgqg_player_ids', JSON.stringify(playerIds));
      updatePlayerIdsPanel();
      showToast('角色已删除');
    }

    // ---------------------- 单日累充方案相关功能 ----------------------
    // 打开累充方案选择弹窗
    function openRechargeModal(amount) {
      currentRechargeAmount = amount;
      const modal = document.getElementById('rechargeModal');
      const modalTitle = document.getElementById('rechargeModalTitle');
      const schemeList = document.getElementById('rechargeSchemeList');
      
      // 设置弹窗标题
      modalTitle.textContent = `选择单日累充${amount}方案`;
      
      // 清空方案列表
      schemeList.innerHTML = '';
      
      // 获取当前金额对应的方案
      const schemes = dailyRechargeSchemes[amount] || [];
      
      if (schemes.length === 0) {
        schemeList.innerHTML = '<div class="recharge-scheme-option">暂无该累充档位的方案</div>';
      } else {
        // 生成方案选项
        schemes.forEach((scheme, index) => {
          const option = document.createElement('div');
          option.className = 'recharge-scheme-option';
          option.innerHTML = `
            <div class="recharge-scheme-name">${scheme.name}</div>
            <div class="recharge-scheme-desc">${scheme.desc}</div>
          `;
          
          // 点击方案添加到当前结果
          option.onclick = () => {
            addRechargeSchemeToResult(scheme);
            closeModal('rechargeModal');
          };
          
          schemeList.appendChild(option);
        });
      }
      
      // 显示弹窗
      modal.style.display = 'flex';
      setTimeout(() => modal.classList.add('show'), 10);
    }

    // 将选中的累充方案添加到当前结果
    function addRechargeSchemeToResult(scheme) {
      if (!scheme || !scheme.items || scheme.items.length === 0) {
        showToast('方案数据异常');
        return;
      }
      
      // 清空当前结果（可选：也可改为追加，此处为覆盖）
      clearResult();
      
      // 添加方案中的所有道具ID
      scheme.items.forEach(item => {
        appendResult(`${item.id}#${item.qty || 1}#1`);
      });
      
      showToast(`已添加【${scheme.name}】到当前方案`);
    }

    // 初始化
    window.addEventListener('load', () => {
      // 加载保存的结果
      const saved = localStorage.getItem('sgqg_saved_results');
      if (saved) {
        try {
          savedResults = JSON.parse(saved);
          // 兼容旧版本数据（数组格式）
          if (Array.isArray(savedResults)) {
            savedResults = { common: savedResults, uncommon: [] };
            localStorage.setItem('sgqg_saved_results', JSON.stringify(savedResults));
          }
          updateSavedResultsPanel();
        } catch(e) {
          console.error('加载保存结果失败:', e);
        }
      }
      
      // 加载角色ID
      const players = localStorage.getItem('sgqg_player_ids');
      if (players) {
        try {
          playerIds = JSON.parse(players);
          updatePlayerIdsPanel();
        } catch(e) {
          console.error('加载角色ID失败:', e);
        }
      }
      
      document.getElementById('itemList').style.display = 'none';
      document.getElementById('combineList').style.display = 'none';
      
      // 聚焦时全选内容方便编辑
      document.getElementById('result').addEventListener('focus', function() {
        const range = document.createRange();
        range.selectNodeContents(this);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
      });
      
      // 关闭模态框点击背景
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        modal.addEventListener('click', function(e) {
          if (e.target === this) {
            closeModal(this.id);
          }
        });
      });
    });
  </script>
</body>
</html>
